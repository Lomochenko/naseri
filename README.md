# سیستم ERP یراق‌آلات ناصری

سیستم مدیریت منابع سازمانی (ERP) پیشرفته برای فروشگاه یراق‌آلات ناصری با رابط کاربری مدرن و واکنش‌گرا.

<div dir="rtl">
  <p align="center">
    <img src="https://raw.githubusercontent.com/themeselection/materio-vuetify-vuejs-admin-template-free/main/.github/images/materio-vuetify-vuejs-admin-template-free.png" alt="پروژه یراق‌آلات ناصری" width="800" />
  </p>
</div>

## معرفی پروژه

این پروژه یک سیستم مدیریت یکپارچه است که برای فروشگاه‌های یراق‌آلات و سخت‌افزار طراحی شده است. این سیستم شامل بخش‌های متعددی از جمله مدیریت محصولات، موجودی، فروش، خرید و حسابداری می‌باشد.

ویژگی‌های اصلی:
- **بک‌اند**: Django + Django REST Framework با معماری RESTful
- **فرانت‌اند**: Vue.js 3 + Vuetify 3 + قالب مدیریتی Materio
- **سیستم کنترل دسترسی**: محدودیت دسترسی بر اساس نقش کاربران (RBAC)
- **احراز هویت امن**: سیستم توکن‌محور برای احراز هویت کاربران
- **رابط کاربری RTL**: بهینه‌سازی شده برای زبان فارسی
- **واکنش‌گرایی کامل**: سازگار با تمامی دستگاه‌ها از موبایل تا دسکتاپ

## بخش‌های مختلف سیستم

- **بک‌اند**: [راهنمای بک‌اند](#راه‌اندازی-بک‌اند)
- **فرانت‌اند**: [راهنمای فرانت‌اند](./frontend/README.md)

## نیازمندی‌ها

### بک‌اند

- Python 3.8 یا بالاتر
- Django 5.0.7 یا بالاتر
- Django REST Framework 3.16.0 یا بالاتر
- سایر پکیج‌های مورد نیاز در فایل requirements.txt

### فرانت‌اند

- Node.js 16.0 یا بالاتر
- npm 8.0.0 یا بالاتر

## راه‌اندازی بک‌اند

### روش اول: استفاده از فایل batch (ویندوز)

1. فایل `setup_and_run.bat` را اجرا کنید.
2. این فایل به صورت خودکار محیط مجازی را ایجاد می‌کند، پکیج‌های مورد نیاز را نصب می‌کند و سرور را اجرا می‌کند.

### روش دوم: راه‌اندازی دستی

1. ایجاد محیط مجازی:
   ```
   python -m venv venv
   ```

2. فعال‌سازی محیط مجازی:
   - ویندوز (CMD):
     ```
     venv\Scripts\activate
     ```
   - ویندوز (PowerShell):
     ```
     .\venv\Scripts\Activate.ps1
     ```  
   - لینوکس/مک:
     ```
     source venv/bin/activate
     ```

3. نصب پکیج‌های مورد نیاز:
   ```
   pip install -r requirements.txt
   ```

4. اجرای مایگریشن‌ها:
   ```
   python manage.py migrate
   ```

5. ایجاد کاربر ادمین (اختیاری):
   ```
   python manage.py createsuperuser
   ```

6. اجرای سرور:
   ```
   python manage.py runserver
   ```

## راه‌اندازی فرانت‌اند

برای راه‌اندازی بخش فرانت‌اند، به دایرکتوری `frontend` رفته و دستورات زیر را اجرا کنید:

### در Bash/CMD

1. نصب وابستگی‌ها:
   ```
   cd frontend && npm install
   ```

2. اجرای سرور توسعه:
   ```
   cd frontend && npm run dev
   ```

### در PowerShell

توجه داشته باشید که در PowerShell نمی‌توان از عملگر `&&` استفاده کرد. به جای آن از `;` استفاده کنید:

1. نصب وابستگی‌ها:
   ```
   cd frontend; npm install
   ```

2. اجرای سرور توسعه:
   ```
   cd frontend; npm run dev
   ```

یا به صورت جداگانه:
   ```
   cd frontend
   npm run dev
   ```

3. ساخت نسخه تولید:
   ```
   cd frontend; npm run build
   ```

## اجرای ساده‌تر با npm از پوشه اصلی

پروژه دارای `package.json` در پوشه اصلی است که امکان اجرای آسان‌تر را فراهم می‌کند:

1. نصب وابستگی‌های npm در پوشه اصلی:
   ```
   npm install
   ```

2. نصب وابستگی‌های فرانت‌اند:
   ```
   npm run install:frontend
   ```

3. اجرای همزمان بک‌اند و فرانت‌اند با یک دستور:
   ```
   npm start
   ```

4. یا اجرای جداگانه:
   ```
   npm run start:backend  # برای اجرای فقط بک‌اند
   npm run start:frontend  # برای اجرای فقط فرانت‌اند
   ```

5. ساخت نسخه تولید فرانت‌اند:
   ```
   npm run build:frontend
   ```

## اجرای همزمان بک‌اند و فرانت‌اند

برای اجرای کامل پروژه، نیاز است که هم سرور بک‌اند و هم سرور فرانت‌اند اجرا شوند:

1. ابتدا سرور بک‌اند را اجرا کنید:
   ```
   python manage.py runserver
   ```

2. سپس در یک ترمینال دیگر، سرور فرانت‌اند را اجرا کنید:
   - در CMD:
   ```
   cd frontend && npm run dev
   ```
   - در PowerShell:
   ```
   cd frontend; npm run dev
   ```

3. حالا می‌توانید به آدرس `http://localhost:5173` مراجعه کنید تا برنامه را ببینید.

## کاربران پیش‌فرض

- **ادمین**:
  - شماره تلفن: 09122173180
  - رمز عبور: Admin@123

- **مدیر**:
  - شماره تلفن: 09123456788
  - رمز عبور: Manager@123

## ماژول‌های سیستم

- **کاربران**: مدیریت کاربران و احراز هویت
- **محصولات**: مدیریت محصولات و دسته‌بندی‌ها
- **موجودی**: مدیریت موجودی و انبار
- **فروش**: مدیریت فروش و مشتریان
- **خرید**: مدیریت خرید و تامین‌کنندگان
- **حسابداری**: مدیریت حسابداری و مالی

## مستندات API

برای دسترسی به مستندات API، پس از اجرای سرور، به آدرس‌های زیر مراجعه کنید:

- **Swagger UI**: `http://127.0.0.1:8000/swagger/`
- **ReDoc**: `http://127.0.0.1:8000/redoc/`
- **OpenAPI JSON**: `http://127.0.0.1:8000/swagger.json/`
- **OpenAPI YAML**: `http://127.0.0.1:8000/swagger.yaml/`

## عیب‌یابی متداول

### مشکلات PowerShell

اگر در PowerShell با خطای `&&` مواجه شدید، از `;` به جای `&&` استفاده کنید یا دستورات را جداگانه اجرا کنید.

### خطای npm در پوشه اصلی

اگر با خطای `npm error code ENOENT` هنگام اجرای `npm run dev` در پوشه اصلی مواجه شدید، مطمئن شوید که:
1. دستور را در پوشه `frontend` اجرا می‌کنید: `cd frontend; npm run dev`
2. یا از دستورات `npm start` یا `npm run start:frontend` در پوشه اصلی استفاده می‌کنید

### خطای Template در Vue.js

اگر با خطای "روکش دوگانه" (multiple root" یا "error in render: Multiple templates") مواجه شدید:
1. بررسی کنید که کامپوننت فقط یک تگ `<template>` داشته باشد
2. چک کنید که ترتیب تگ‌های `<template>` و `<script>` و `<style>` صحیح باشد
3. مطمئن شوید که فرمت کدهای Vue درست باشد

### خطای CORS

اگر با خطای CORS مواجه شدید، موارد زیر را بررسی کنید:
1. مطمئن شوید که `django-cors-headers` در `INSTALLED_APPS` در `settings.py` قرار دارد
2. مطمئن شوید که `corsheaders.middleware.CorsMiddleware` قبل از `django.middleware.common.CommonMiddleware` در `MIDDLEWARE` قرار دارد
3. تنظیمات `CORS_ALLOW_ALL_ORIGINS = True` یا `CORS_ALLOWED_ORIGINS` در `settings.py` تنظیم شده است

### خطای احراز هویت

اگر با مشکل احراز هویت مواجه شدید:
1. مطمئن شوید که `rest_framework.authtoken` در `INSTALLED_APPS` در `settings.py` قرار دارد
2. مطمئن شوید که `TOKEN_KEY` در فایل‌های `auth.js` و `axios.js` یکسان است
3. دستور `python manage.py migrate` را اجرا کرده‌اید تا جداول توکن ساخته شوند

### خطای 404 در API‌ها

اگر با خطای 404 در درخواست به API‌ها مواجه شدید:
1. مطمئن شوید که آدرس API صحیح است
2. اطمینان حاصل کنید که اپلیکیشن مربوطه در `INSTALLED_APPS` در `settings.py` قرار دارد
3. آدرس‌های API در `urls.py` به درستی تعریف شده‌اند

## بهینه‌سازی‌های اخیر

### بهینه‌سازی فرانت‌اند
- رفع مشکل تگ‌های دوتایی `<template>` در فایل `Dashboard.vue`
- بهبود ساختار کامپوننت‌ها و صفحات Vue.js
- اصلاح آدرس API محصولات در `apiService.js`
- ساده‌سازی اجرای پروژه با اضافه کردن `package.json` در ریشه پروژه
- حذف فایل‌های اضافی و تکراری

### بهینه‌سازی بک‌اند
- اصلاح مشکلات احراز هویت
- بهبود ساختار URL‌های API
- اضافه کردن توضیحات بیشتر در مستندات API

## معماری سیستم

### بک‌اند (Django)

بک‌اند با استفاده از Django و Django REST Framework توسعه یافته است. این بخش مسئولیت‌های زیر را بر عهده دارد:

- مدیریت پایگاه داده
- ارائه APIs برای عملیات CRUD
- احراز هویت و مجوزهای دسترسی
- پردازش منطق تجاری
- ارتباط با سرویس‌های خارجی (در صورت نیاز)

### فرانت‌اند (Vue.js)

فرانت‌اند با استفاده از Vue.js 3 و Vuetify 3 و قالب مدیریتی Materio توسعه یافته است. این بخش مسئولیت‌های زیر را بر عهده دارد:

- ارائه رابط کاربری
- مدیریت state برنامه
- مدیریت مسیریابی
- ارتباط با API‌های بک‌اند
- واکنش‌گرایی و سازگاری با انواع دستگاه‌ها

## تنظیمات منطقه‌ای

این پروژه برای استفاده در ایران بهینه‌سازی شده است:

- **زبان پیش‌فرض**: فارسی
- **منطقه زمانی**: تهران (Asia/Tehran)
- **فرمت تاریخ**: تاریخ شمسی (jYYYY/jMM/jDD)
- **فونت پیش‌فرض**: وزیر
- **جهت طراحی**: راست به چپ (RTL)

## مجوز استفاده

این پروژه تحت مجوز MIT منتشر شده است. برای اطلاعات بیشتر به فایل [LICENSE](LICENSE) مراجعه کنید.
